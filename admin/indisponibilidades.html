<!-- Cole isso no <body> do seu arquivo /admin/indisponibilidades.html -->
<div id="loading-container" style="text-align: center; padding-top: 4rem;">Carregando...</div>
<div id="main-content" class="container" style="display: none;">
    <div class="header">
        <h1>Indisponibilidades</h1>
        <a href="/admin" class="button">Voltar ao Dashboard</a>
    </div>

    <div class="card">
        <h2 class="form-title">Adicionar Indisponibilidade</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="volunteer-select">Voluntário</label>
                <select id="volunteer-select" required></select>
            </div>
            
            <!-- Campos de Data e Hora de Início -->
            <div class="form-group">
                <label for="start-date">Data de Início</label>
                <input type="date" id="start-date" required>
            </div>
            <div class="form-group">
                <label for="start-time">Hora de Início</label>
                <input type="time" id="start-time">
            </div>

            <!-- Campos de Data e Hora de Fim -->
            <div class="form-group">
                <label for="end-date">Data de Fim</label>
                <input type="date" id="end-date">
            </div>
            <div class="form-group">
                <label for="end-time">Hora de Fim</label>
                <input type="time" id="end-time">
            </div>

            <!-- Checkbox para "Dia Inteiro" -->
            <div class="form-group" style="flex-direction: row; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="all-day-checkbox" onchange="toggleTimeFields()">
                <label for="all-day-checkbox" style="margin-bottom: 0;">O dia inteiro</label>
            </div>

            <div class="form-group">
                <label for="reason">Motivo (opcional)</label>
                <input type="text" id="reason" placeholder="Ex: Viagem, Trabalho">
            </div>
        </div>
        <button class="button" style="margin-top: 1.5rem; width: 100%;" onclick="addUnavailability()">Adicionar</button>
    </div>

    <div class="card">
        <h2 class="form-title">Indisponibilidades Cadastradas</h2>
        <ul id="unavailability-list" class="unavailability-list"></ul>
    </div>
</div>
<script>
    // ... (constantes do Supabase e função formatDate) ...

    // NOVA função para formatar data e hora
    function formatDateTime(dateString) {
        if (!dateString) return 'Data inválida';
        const date = new Date(dateString);
        return date.toLocaleString('pt-BR', {
            day: '2-digit', month: '2-digit', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
    }

    // NOVA função para controlar os campos de hora
    function toggleTimeFields() {
        const isChecked = document.getElementById('all-day-checkbox').checked;
        document.getElementById('start-time').disabled = isChecked;
        document.getElementById('end-time').disabled = isChecked;
        if (isChecked) {
            document.getElementById('start-time').value = '';
            document.getElementById('end-time').value = '';
        }
    }

    function renderUnavailabilities(items) {
        const list = document.getElementById('unavailability-list');
        if (!items || items.length === 0) {
            list.innerHTML = '<li>Nenhuma indisponibilidade cadastrada.</li>';
            return;
        }
        list.innerHTML = items.map(item => `
            <li class="unavailability-item" id="item-${item.id}">
                <div class="unavailability-info">
                    <span><strong>${item.members.full_name}</strong>: de ${formatDateTime(item.start_time)} até ${formatDateTime(item.end_time)}</span>
                    ${item.reason ? `<span style="color: var(--text-secondary); margin-left: 0.5rem;">- ${item.reason}</span>` : ''}
                </div>
                <button class="remove-btn" onclick="removeUnavailability('${item.id}')">&times;</button>
            </li>
        `).join('');
    }

    // Função addUnavailability ATUALIZADA
    async function addUnavailability() {
        const member_id = document.getElementById('volunteer-select').value;
        const startDate = document.getElementById('start-date').value;
        let startTime = document.getElementById('start-time').value;
        let endDate = document.getElementById('end-date').value;
        let endTime = document.getElementById('end-time').value;
        const reason = document.getElementById('reason').value;
        const isAllDay = document.getElementById('all-day-checkbox').checked;

        if (!member_id || !startDate) {
            alert('Por favor, selecione um voluntário e uma data de início.');
            return;
        }

        // Lógica para "Dia Inteiro"
        if (isAllDay) {
            startTime = '00:00';
            endTime = '23:59';
        } else if (!startTime || !endTime) {
            alert('Por favor, preencha os horários de início e fim, ou marque "O dia inteiro".');
            return;
        }

        // Se a data de fim não for preenchida, usa a mesma da de início
        if (!endDate) {
            endDate = startDate;
        }

        // Constrói os timestamps completos no formato ISO
        const final_start_time = `${startDate}T${startTime}:00`;
        const final_end_time = `${endDate}T${endTime}:00`;

        try {
            const { error } = await supabaseClient.functions.invoke('create-unavailability', {
                body: { member_id, start_time: final_start_time, end_time: final_end_time, reason }
            });
            if (error) throw error;
            alert('Indisponibilidade adicionada com sucesso!');
            initializePage();
        } catch (error) {
            alert(`Erro ao adicionar: ${error.message}`);
        }
    }

    // ... (resto do seu JavaScript: removeUnavailability, initializePage, etc.)
</script>
